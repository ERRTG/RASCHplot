# Chunk 44
DIFplot(fit)
#SPADI.complete <- SPADI[complete.cases(SPADI), ]
#it.SPADI <- SPADI.complete[, 9:16]
#fit <- PCM(it.SPADI)
strat.vars <- list(sex = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
library(RASCHplot)
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
library(RASCHplot)
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
library(RASCHplot)
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
library(RASCHplot)
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
library(RASCHplot)
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars) + guides(colour = "Over 60 years")
DIFplot(model = fit, strat.vars = strat.vars) + labs(colour = "Over 60 years")
strat.vars <- list(gender = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars) + labs(colour = "Over 60 years")
SPADI.complete[, "over60"]
lower.groups <- list(gender = list("0" = c(0, 1, 2, 5, 8, 10), "1" = c(0,  5, 10)),
over60 = list("0" = c(0, 1, 2, 3, 5),
"1" = c(0, 1, 2, 5, 7, 8, 9, 10)))
DIFplot(model = fit, strat.vars = strat.vars, lower.groups = lower.groups)
lower.groups <- list(gender = list("1" = c(0, 1, 2, 5, 8, 10), "2" = c(0,  5, 10)),
over60 = list("0" = c(0, 1, 2, 3, 5),
"1" = c(0, 1, 2, 5, 7, 8, 9, 10)))
DIFplot(model = fit, strat.vars = strat.vars, lower.groups = lower.groups)
lower.groups <- list(gender = c(0, 1, 2, 5, 8, 10), over60 = c(0, 3, 6, 9))
DIFplot(model = fit, strat.vars = strat.vars, lower.groups = lower.groups)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
DIFplot(model = fit, which.item = c(1,2), strat.vars = strat.vars)
lower.groups <- list(gender = c(0, 1, 2, 5, 8, 10), over60 = c(0, 3, 6, 9))
DIFplot(model = fit, strat.vars = strat.vars, lower.groups = lower.groups)
DIFplot(model = fit, which.item = c(1,2),
strat.vars = strat.vars, lower.groups = lower.groups)
lower.groups <- list(gender = list("1" = c(0, 1, 2, 5, 8, 10), "2" = c(0,  5, 10)),
over60 = list("0" = c(0, 1, 2, 3, 5),
"1" = c(0, 1, 2, 5, 7, 8, 9, 10)))
DIFplot(model = fit, strat.vars = strat.vars, lower.groups = lower.groups)
devplot::document()
devtools::document()
library(RASCHplot)
vignette(RASCHplot)
vignette("RASCHplot")
devtools::build_rmd()
devtools::build_rmd("vignette_01")
devtools::build_rmd("vignette_01.Rmd")
devtools::build_rmd("vignettes)vignette_01.Rmd")
devtools::build_rmd("vignettes/vignette_01.Rmd")
vignette("RASCHplot")
library(RASCHplot)
vignette("RASCHplot")
library(RASCHplot)
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = model.SPADI, strat.vars = strat.vars)
strat.vars <- list(gender = AMTS.complete[, "gender"], over60 = droplevels(AMTS.complete[, "over60"]))
DIFplot(model = model.SPADI, strat.vars = strat.vars)
DIFplot(model = model.SPADI, which.item = c(1,2), strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = model.SPADI, strat.vars = strat.vars)
DIFplot(model = model.SPADI, which.item = c(1,2), strat.vars = strat.vars)
lower.groups <- list(sex = c(0, 1, 2, 5, 8, 10), agegrp = c(0, 3, 6, 9))
DIFplot(model = model.SPADI, strat.vars = strat.vars, lower.groups = lower.groups)
"1" = c(0, 1, 2, 5, 7, 8, 9, 10)))
lower.groups <- list(gender = list("1" = c(0, 1, 2, 5, 8, 10),
"2" = c(0,  5, 10)),
over60 = list("0" = c(0, 1, 2, 3, 5),
"1" = c(0, 1, 2, 5, 7, 8, 9, 10)))
DIFplot(model = model.SPADI, strat.vars = strat.vars, lower.groups = lower.groups)
DIFplot(model = model.SPADI, strat.vars = strat.vars)
lower.groups <- list(gender = list("1" = c(0, 5, 15, 20, 30, 40),
"2" = c(0,  5, 10)),
over60 = list("0" = c(0, 10, 15, 20),
"1" = c(0, 8, 15, 17, 18, 22, 29, 38)))
DIFplot(model = model.SPADI, strat.vars = strat.vars, lower.groups = lower.groups)
CICCplot(model = model.SPADI)
p <- CICCplot(model = model.SPADI)
p[[1]] +
scale_colour_manual(values = c("burlywood","cornflowerblue"))
CICCplot(model = model.SPADI, which.item = c(3,4))
ciccobj <- CICCplot(model = model.SPADI, which.item = c(3,4))
ciccobj
library(RASCHplot)
ciccobj <- CICCplot(model = model.SPADI, which.item = c(3,4))
ciccobj
ciccobj$`3` +
scale_colour_manual(values = c("burlywood","cornflowerblue")) +
xlim(c(2,8))
devtools::document()
devtools::document()
head(SPADI)
devtools::document()
?CICCplot
?DIFplot
?RASCHplot
?SPADI
vignette(RASCHplot)
vignette("RASCHplot")
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
library(RASCHplot)
browseVignettes("RASCHplot")
?RASCHplot
?CICCplot
?glmnet
?CICCplot
devtools::document()
library(RASCHplot)
?RASCHplot
browseVignettes("RASCHplot")
browseVignettes()
usethis::use_vignette("vignette_01")
?position_dodge
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = model.SPADI, strat.vars = strat.vars)
DIFplot(model = model.SPADI, strat.vars = strat.vars)
library(RASCHplot)
devtools::document()
library(RASCHplot)
devtools::document()
library(RASCHplot)
```{r}
# Chunk 1
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
#echo = TRUE, message=FALSE,
tidy = TRUE,
tidy.opts = list(blank = TRUE, arrow = TRUE),
highlight = TRUE,
#collapse = FALSE,
#cache.extra = R.version, autodep=TRUE,
fig.width=6, fig.height=4, comment=NA,
fig.align="center"
)
library(tidyverse)
OkabeIto <- c("#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7", "#999999")
theme_set(theme_minimal())
options(ggplot2.continuous.colour = OkabeIto)
options(ggplot2.continuous.fill = OkabeIto)
options(ggplot2.discrete.colour = OkabeIto)
options(ggplot2.discrete.fill = OkabeIto)
# Chunk 3: setup
library(RASCHplot)
# Chunk 4
data(SPADI)
# Chunk 5
str(SPADI)
# Chunk 6
itemsIncomp <- SPADI[,9:16]
# Chunk 7
BARplot(itemsIncomp)
# Chunk 8
SPADI.complete <- SPADI[complete.cases(SPADI), ]
items <- SPADI.complete[, 9:16]
# Chunk 9
fit <- eRm::PCM(items)
# Chunk 10
CICCplot(fit)
# Chunk 11
CICCplot(fit, lower.groups = c(0,7,13,14,19,22,27,30,35))
# Chunk 12
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
# Chunk 13
BARplot(itemsIncomp)
# Chunk 14
BARplot(itemsIncomp, which.item = 1)
# Chunk 15
BARplot(itemsIncomp, freq = FALSE)
# Chunk 16
BARplot(itemsIncomp, na.action = "na.rm")
# Chunk 17
BARplot(itemsIncomp, addsums = TRUE)
# Chunk 18
strat.var.gender <- factor(SPADI$gender)
levels(strat.var.gender) <-  list("male" = 1, "female" = 2)
# Chunk 19
BARplot(itemsIncomp, strat.var = strat.var.gender)
# Chunk 20
BARplot(itemsIncomp, which.item = 2, strat.var = strat.var.gender)
# Chunk 21
BARplot(itemsIncomp, which.item = 2, freq = FALSE, strat.var = strat.var.gender)
# Chunk 22
theme_set(theme_gray())
BARplot(itemsIncomp)
# Chunk 23
theme_set(theme_minimal())
# Chunk 24
barobj <- BARplot(itemsIncomp)
# Chunk 25
barobj +
scale_fill_brewer(palette="Set3", na.value = "grey")
# Chunk 26
barobj + theme(legend.position="top")
# Chunk 27
barobj + ggtitle("Distribution of item responses")
# Chunk 28
CICCplot(fit)
# Chunk 29
CICCplot(fit, lower.groups = c(1,5,15,20,30,35))
# Chunk 30
CICCplot(fit, error.bar = FALSE)
# Chunk 31
CICCplot(fit, which.item = c(3,4))
# Chunk 32
CICCplot(fit, which.item = "all")
# Chunk 33
CICCplot(model = fit, which.item = "all", grid.items = TRUE,
common.legend = TRUE, ncol = 2, nrow = 4)
# Chunk 34
p <- CICCplot(model = fit, which.item = c(1,2))
p
# Change colours for item 1
p[[1]] +
scale_colour_manual(values = c("burlywood","cornflowerblue"))
# Change colours for item 2
p[[2]] +
scale_colour_manual(values = c("burlywood","cornflowerblue"))
# Chunk 35
theme_set(theme_gray())
CICCplot(fit)
# Chunk 36
theme_set(theme_minimal())
# Chunk 37
ciccobj <- CICCplot(fit)[[1]]
# Chunk 38
ciccobj +
scale_colour_manual(values = c("burlywood","cornflowerblue"))
# Chunk 39
ciccobj +
scale_colour_manual(values = c("burlywood","cornflowerblue")) +
xlim(c(3, 37))
# Chunk 40
ciccobj +
ylim(c(0,5))
# Chunk 41
ciccobj +
scale_x_continuous(breaks = seq(0, 40, 5), minor_breaks = NULL) +
scale_y_continuous(breaks = 0:5, minor_breaks = NULL)   +
ylim(c(0,5))
# Chunk 42
ciccobj +
ylab("Item-score for item D1") +
ggtitle("")
# Chunk 43
ciccobj +
theme(plot.title = element_text(hjust = 0.5))
# Chunk 44
DIFplot(fit)
# Chunk 45
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
# Chunk 46
strat.vars <- list(gender = SPADI.complete[, "gender"], over60 = SPADI.complete[, "over60"])
DIFplot(model = fit, strat.vars = strat.vars)
strat.vars <- list(gender = SPADI.complete[, "gender"])
DIFplot(model = fit, strat.vars = strat.vars)
DIFplot(model = fit, strat.vars = strat.vars, dodge.width = 0)
browseVignettes("RASCHplot
")"
"
browseVignettes("RASCHplot")
library(eRm)
?eRm
?RM
?CICCplot
library(RASCHplot)
?CICCplot
library(ggplot2)
?geom_histogram
?CICCplot
?ggplot
devtools::document()
library(RASCHplot)
?CICCplot
devtools::document()
library(RASCHplot)
?CICCplot
devtools::document()
library(RASCHplot)
devtools::document()
library(RASCHplot)
?ggpubr
scale_x_continuous integer_breaks
devtools::document()
library(RASCHplot)
devtools::document()
library(RASCHplot)
devtools::document()
devtools::document()
library(RASCHplot)
CICCplot(model = model.SPADI)
library(eRm)
data(SPADI)
SPADI.complete <- SPADI[complete.cases(SPADI), ]
it.SPADI <- SPADI.complete[, 9:16]
model.SPADI <- eRm::PCM(it.SPADI)
# Plot item 1
CICCplot(model = model.SPADI)
model = model.SPADI
which.item = 1
lower.groups = "all"
data <- model$X
betas <- model$betapar
k <- ncol(data)
m_i <- sapply(1:k, FUN = function(i) length(unique(data[,i]))-1)
parsidx <- rep(1:k, m_i)
if (any(which.item == "all")) {
itmidx <- 1:k
} else {
itmidx <- suppressWarnings(as.numeric(which.item))
if (anyNA(itmidx)) {
stop("all values of which.item can not be converted to numeric")
}
}
n.itemcat <- apply(data, 2, FUN = function(x) {max(x, na.rm = T) - min(x, na.rm = T)})
par.itemgrp <- rep(1:ncol(data), times = n.itemcat)
if (is.double(lower.groups) | is.integer(lower.groups)) {
if (any(lower.groups>length(betas))) {
stop("lower.group index greater than maximum possible score")
}
}
if (any(itmidx > k)) {
stop("some values of which.item are greater than number of items in the model")
}
if (any(itmidx < 1)) {
stop("some values of which.item < 1")
}
pp <- list(rep(NA, length(itmidx)))
ii <- itmidx
Tot.val <- 0:length(betas)
plotidx <- 1
itm=1
Tot.val <- 0:length(betas)
exp.val <- sapply(Tot.val, FUN = function(R) {
l <- par.itemgrp[par.itemgrp!=itm]
par.itemgrp_noitem <- ifelse(l > itm, l-1, l)
g1 <- gamma_r_rec_pcm(betas, R, par.itemgrp)
return(sum(sapply(1:sum(par.itemgrp==itm), FUN = function(X) {
g2 <- gamma_r_rec_pcm(betas[par.itemgrp!=itm], R-X, par.itemgrp_noitem)
return(X*exp(betas[par.itemgrp==itm][X])*g2/g1)})))
})
#' Gamma polynomials (recursive formula)
#' @param pars A vector of item parameters
#' @param r The total score
#' @param par.grp The grouping of scores
#' @noRd
gamma_r_rec_pcm <- memoise::memoise(function(pars, r, par.grp){
if (r == 0)
return(1)
if (r > length(pars) | r<0)
return(0)
if (r != 0 | r <= length(pars)) {
A <- exp(pars[par.grp==1])
B <- sapply(1:length(pars[par.grp==1]), FUN = function(x){
gamma_r_rec_pcm(pars = pars[par.grp!=1],
r = r-x,
par.grp = par.grp[par.grp!=1]-1)})
C <- gamma_r_rec_pcm(pars = pars[par.grp!=1], r = r, par.grp = par.grp[par.grp!=1]-1)
return({sum(A * B) + C})
}
})
#' A function factory for getting integer y-axis values.
#' @param n n
#' @noRd
integer_breaks <- function(n = 5, ...) {
fxn <- function(x) {
breaks <- floor(pretty(x, n, ...))
names(breaks) <- attr(breaks, "labels")
breaks
}
return(fxn)
}
exp.val <- sapply(Tot.val, FUN = function(R) {
l <- par.itemgrp[par.itemgrp!=itm]
par.itemgrp_noitem <- ifelse(l > itm, l-1, l)
g1 <- gamma_r_rec_pcm(betas, R, par.itemgrp)
return(sum(sapply(1:sum(par.itemgrp==itm), FUN = function(X) {
g2 <- gamma_r_rec_pcm(betas[par.itemgrp!=itm], R-X, par.itemgrp_noitem)
return(X*exp(betas[par.itemgrp==itm][X])*g2/g1)})))
})
data_exp <- data.frame(Tot.val, exp.val)
!is.double(lower.groups) & !is.integer(lower.groups)
lower.groups == "all"
#Tot.val_grp <- 0:length(phi)
Tot.val_grp <- 0:length(betas)
obs.val_grp <- sapply(Tot.val_grp, FUN = function(x) {mean(data[which(rowSums(data) == x), itm])})
var.val_grp <- sapply(Tot.val_grp, FUN = function(x) {var(data[which(rowSums(data) == x), itm])})
n.val_grp <- sapply(Tot.val_grp, FUN = function(x) {length(data[which(rowSums(data) == x), itm])})
is.double(lower.groups)|is.integer(lower.groups)
data_obs <- data.frame(Tot.val_grp, obs.val_grp, var.val_grp, n.val_grp, CI.bound = NA)
data_obs <- data_obs[data_obs$n.val_grp != 0, ]
error.bar
error.bar = TRUE
if (error.bar) {
data_obs$CI.bound <- 1.96*sqrt(data_obs[,3]/data_obs[,4])
}
col <- c("Expected" = "darkgrey", "Observed" = "orange")
itmtit <- colnames(data)[itm]
pp[[plotidx]] <- ciccplot(data_exp, Tot.val, exp.val, data_obs, Tot.val_grp, obs.val_grp, itmtit, col)
#' Internal CICC plot function
#' @param data_exp data_exp
#' @param Tot.val Tot.val
#' @param exp.val exp.val
#' @param data_obs data_obs
#' @param Tot.val_grp Tot.val_grp
#' @param obs.val_grp obs.val_grp
#' @param itmtit itmtit
#' @param col col
#' @noRd
ciccplot <- function(data_exp, Tot.val, exp.val, data_obs, Tot.val_grp, obs.val_grp, itmtit, CI.bound, col) {
x <- ggplot(data = data_exp, aes(x = Tot.val, y= exp.val, color = "Expected")) +
geom_line() + #linetype = "dashed") +
#geom_point() +
geom_point(data = data_obs, aes(x = Tot.val_grp, y = obs.val_grp, color = "Observed"), size = 1) +
scale_colour_manual(values = col) +
ggtitle(paste0("Item: ", itmtit)) +
xlab("Total Score") +
ylab("Item-Score") +
geom_errorbar(data = data_obs, aes(x = Tot.val_grp, y = obs.val_grp,
ymin = obs.val_grp - .data$CI.bound, ymax = obs.val_grp + .data$CI.bound,
color = "Observed"),
width = 0) + #, size = .5) +
scale_x_continuous(breaks = integer_breaks(), minor_breaks = Tot.val) + #breaks = Tot.val) +
guides(colour = guide_legend(override.aes = list(shape = c(NA, 1))))
}
pp[[plotidx]] <- ciccplot(data_exp, Tot.val, exp.val, data_obs, Tot.val_grp, obs.val_grp, itmtit, col)
plotidx <- plotidx+1
library(RASCHplot)
CICCplot(model = model.SPADI)
?all_of
.data$
items <- SPADI[,9:16]
which.item = "all"
freq = TRUE
addsums = FALSE
na.action = c("na.plot")
(is.double(which.item) | is.integer(which.item))
if (is.double(which.item) | is.integer(which.item)) {
if (any(which.item < 1) | any(which.item > ncol(data))) {
stop("some values of which.item are smaller than 1 or greater than number of items in the model")
}
}
if(any(class(data) %in% c("Rm", "eRm"))) {
df <- data$X
} else if (any(class(data) == "matrix")) {
df <- as.data.frame(data)
} else {
df <- data
}
if (!is.null(strat.var) & length(strat.var) != nrow(df)) {
stop("lengths of stratification variable must equal number of rows in data input")
}
strat.var = NULL
if (is.null(strat.var)) {
longdf <- longdffct(df, which.item, freq)
barplt(longdf, addsums, na.action, freq)
} else {
longdf <- longdffct(df, which.item, freq, strat.var)
barplt(longdf, addsums, na.action, freq, strat.var)
}
any(is.numeric(which.item)) & length(which.item) == 1
dfs <- data.frame(df, strat.var = strat.var)
df
all(which.item == "all")
if (all(which.item == "all")) {
which.item <- 1:ncol(df)
}
is.null(strat.var)
df %>%
dplyr::select(dplyr::all_of(which.item))
library(tidyverse)
df %>%
dplyr::select(dplyr::all_of(which.item))
df %>%
dplyr::select(dplyr::all_of(which.item)) %>%
tidyr::pivot_longer(dplyr::any_of(colnames(df)[which.item]), names_to = "item", values_to = "Score")
df %>%
dplyr::select(dplyr::all_of(which.item)) %>%
tidyr::pivot_longer(dplyr::any_of(colnames(df)[which.item]), names_to = "item", values_to = "Score") %>%
dplyr::mutate(Score = as.factor(Score))
df %>%
dplyr::select(dplyr::all_of(which.item)) %>%
tidyr::pivot_longer(dplyr::any_of(colnames(df)[which.item]), names_to = "item", values_to = "Score") %>%
dplyr::mutate(Score = as.factor(.data$Score))
devtools::document()
?qpdf
library(qpdf)
install.packages("qpdf")
library(pdftools)
install.packages("pdftools")
library(RASCHplot)
